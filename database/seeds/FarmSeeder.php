<?php

use App\Model\Farm;
use App\Model\FarmLevel;
use Illuminate\Database\Seeder;
use Carbon\Carbon;
use App\Model\GameResource;

class FarmSeeder extends Seeder
{
    /**
     * Run the database seeds.
     *
     * @return void
     */
    public function run()
    {
    	$game_resources = GameResource::all();

    	/** @var GameResource $corn */
        $corn = $game_resources->where('title', 'corn')->first();
        /** @var GameResource $wood */
    	$wood = $game_resources->where('title', 'wood')->first();
    	/** @var GameResource $iron */
    	$iron = $game_resources->where('title', 'iron')->first();
    	/** @var GameResource $clay */
        $clay  = $game_resources->where('title', 'clay')->first();

    	$resources = [$corn, $wood, $iron, $clay];

        $production = [6, 21, 39, 63, 93, 138, 210, 294, 420, 609, 840, 1176, 1575, 2079, 2667, 3360, 4200, 5460, 6720, 8400, 10290];
        $culture = [0,1,1,2,2,2,3,4,4,5,6,7,9,11,13,15,18,22,27,32,38];

        $construction = [
            'resources' => [
                $corn->id => [
                    $corn->id => [20,35,55,95,155,260,435,725,1210,2020,3375,5635,9410,15715,26245,43830,73195,122240,204140,340915],
                    $wood->id => [70,115,195,325,545,910,1520,2535,4235,7070,11810,19725,32940,55005,91860,153405,256190,427835,714485,1193195],
                    $iron->id => [70,115,195,325,545,910,1520,2535,4235,7070,11810,19725,32940,55005,91860,153405,256190,427835,714485,1193195],
                    $clay->id => [90,150,250,420,700,1170,1950,3260,5445,9095,15185,25360,42350,70720,118105,197240,329385,550075,918625,1534105]
                ],
                $wood->id => [
                    $corn->id => [60,100,165,280,465,780,1300,2175,3630,6060,10125,16905,28230,47150,78740,131490,219590,366715,612420,1022740],
                    $wood->id => [40,65,110,185,310,520,870,1450,2420,4040,6750,11270,18820,31430,52490,87660,146395,244480,408280,681825],
                    $iron->id => [50,85,140,235,390,650,1085,1810,3025,5050,8435,14090,23525,39290,65615,109575,182995,305600,510350,852280],
                    $clay->id => [100,165,280,465,780,1300,2170,3625,6050,10105,16870,28175,47055,78580,131230,219155,365985,611195,1020695,1704565]
                ],
                $iron->id => [
                    $corn->id => [60,100,165,280,465,780,1300,2175,3630,6060,10125,16905,28230,47150,78740,131490,219590,366715,612420,1022740],
                    $wood->id => [100,165,280,465,780,1300,2170,3625,6050,10105,16870,28175,47055,78580,131230,219155,365985,611195,1020695,1704565],
                    $iron->id => [30,50,85,140,235,390,650,1085,1815,3030,5060,8455,14115,23575,39370,65745,109795,183360,306210,511370],
                    $clay->id => [80,135,225,375,620,1040,1735,2900,4840,8080,13500,22540,37645,62865,104985,175320,292790,488955,816555,1363650]
                ],
                $clay->id => [
                    $corn->id => [50,85,140,235,390,650,1085,1810,3025,5050,8435,14090,23525,39290,65615,109575,182995,305600,510350,852280],
                    $wood->id => [80,135,225,375,620,1040,1735,2900,4840,8080,13500,22540,37645,62865,104985,175320,292790,488955,816555,1363650],
                    $iron->id => [80,135,225,375,620,1040,1735,2900,4840,8080,13500,22540,37645,62865,104985,175320,292790,488955,816555,1363650],
                    $clay->id => [40,65,110,185,310,520,870,1450,2420,4040,6750,11270,18820,31430,52490,87660,146395,244480,408280,681825],
                ]
            ],
            'times' => [
                $corn->id => ['0:00:50','0:02:30','0:05:00','0:09:10','0:15:40','0:26:20','0:43:10','1:10:10','1:53:30','3:02:40','4:53:20','7:50:30','12:34:00','20:07:30','32:13:00','51:34:00','82:31:30','132:03:20','211:18:30','338:06:50'],
                $wood->id => ['0:01:30','0:03:30','0:06:40','0:11:40','0:19:50','0:32:40','0:53:30','1:26:40','2:19:40','3:44:40','6:00:30','9:38:00','15:26:00','24:42:40','39:33:20','63:18:30','101:18:40','162:07:10','259:24:30','415:04:20'],
                $iron->id => ['0:02:30','0:05:10','0:09:20','0:16:00','0:26:40','0:43:50','1:11:10','1:55:00','3:05:00','4:57:10','7:56:40','12:43:40','20:23:10','32:38:00','52:14:00','83:35:30','133:45:50','214:02:30','342:29:10','547:59:50'],
                $clay->id => ['0:01:10','0:03:00','0:06:00','0:10:40','0:18:20','0:30:20','0:49:40','1:20:40','2:10:10','3:29:20','5:36:10','8:59:00','14:23:30','23:02:40','36:53:20','59:02:20','94:28:50','151:11:10','241:55:00','387:05:10']
            ],
            'population' => [
                $corn->id => [0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2],
                $wood->id => [0,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3],
                $iron->id => [0,3,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3],
                $clay->id => [0,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3]
            ]
        ];
        /** @var GameResource $resource */
        foreach ($resources as $resource) {
            /** @var Farm $farm */
            $farm = $resource->farms()->create(['title' => $resource->title.'_farm']);

            for ($level = 0; $level <= 20; $level++) {
                /** @var FarmLevel $farm_level */
                $farm_level = $farm->levels()->create([
                    'level' => $level,
                    'population' => $construction['population'][$resource->id][$level],
                    'production' => $production[$level],
                    'culture' => $culture[$level]
                ]);
                if ($level > 0) {
                    foreach ($construction['resources'][$resource->id] as $key => $construction_resource) {
                        $farm_level->resources()->create([
                            'game_resource_id' => $key,
                            'value' => $construction_resource[$level-1]
                        ]);
                    }

                    $timestamp = Carbon::createFromTimestamp(0);
                    $time = array_map(function ($a) {return (int)$a;},explode(':', $construction['times'][$resource->id][$level-1]));
                    $timestamp = $timestamp->addHours($time[0])->addMinutes($time[1])->addSeconds($time[2])->timestamp;

                    $farm_level->time()->create([
                        'time' => $timestamp
                    ]);
                }
            }
        }
    }
}
